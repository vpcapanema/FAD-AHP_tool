<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Etapa 4: Comparação Pareada - SIGMA AHP</title>

    <!-- SIGMA AHP specific styles -->
    <link rel="stylesheet" href="sigma-ahp.css">

    <!-- Font Awesome para ícones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <!-- Montserrat Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- PLI Navbar Header -->
    <header class="l-header">
        <nav class="pli-navbar">
            <div class="pli-navbar__container">
                <a href="sigma-ahp.html" class="pli-navbar__brand">
                    <i class="fas fa-calculator"></i> SIGMA - AHP Calculator
                </a>

                <ul class="pli-navbar__nav">
                    <li><a href="sigma-ahp.html" class="pli-navbar__link">Início</a></li>
                    <li><a href="#" class="pli-navbar__link pli-navbar__link--active">Calculadora</a></li>
                    <li><a href="#" class="pli-navbar__link">Ajuda</a></li>
                </ul>

                <div class="pli-navbar__utilities">
                    <button class="pli-navbar__notification">
                        <i class="fas fa-bell"></i>
                        <span class="pli-navbar__notification-badge">3</span>
                    </button>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="l-main">
        <div class="l-container">
            <!-- Breadcrumb Navigation -->
            <nav class="breadcrumb">
                <a href="sigma-ahp.html"><i class="fas fa-home"></i> Início</a>
                <span class="breadcrumb-separator">/</span>
                <a href="step1-criterios.html">Etapa 1</a>
                <span class="breadcrumb-separator">/</span>
                <a href="step2-nomes.html">Etapa 2</a>
                <span class="breadcrumb-separator">/</span>
                <a href="step3-metodo.html">Etapa 3</a>
                <span class="breadcrumb-separator">/</span>
                <span class="breadcrumb-current">Etapa 4: Comparação</span>
            </nav>

            <!-- Progress Bar -->
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-step completed">
                        <div class="progress-circle">1</div>
                        <span>Critérios</span>
                    </div>
                    <div class="progress-step completed">
                        <div class="progress-circle">2</div>
                        <span>Nomes</span>
                    </div>
                    <div class="progress-step completed">
                        <div class="progress-circle">3</div>
                        <span>Método</span>
                    </div>
                    <div class="progress-step active">
                        <div class="progress-circle">4</div>
                        <span>Comparação</span>
                    </div>
                    <div class="progress-step">
                        <div class="progress-circle">5</div>
                        <span>Resultados</span>
                    </div>
                </div>
            </div>

            <!-- Info Card -->
            <section class="ahp-section info-card">
                <div class="info-card-header">
                    <i class="fas fa-info-circle"></i>
                    <h2>Sobre esta Etapa: Comparação Pareada</h2>
                </div>
                <div class="info-card-content">
                    <p>Nesta etapa, você irá <strong>comparar os critérios par a par</strong> utilizando a Escala de Saaty para definir a importância relativa entre eles.</p>
                    
                    <div class="info-highlights">
                        <div class="info-item">
                            <i class="fas fa-balance-scale"></i>
                            <div>
                                <strong>Comparação Relativa</strong>
                                <p>Compare dois critérios por vez, indicando qual é mais importante e em que intensidade.</p>
                            </div>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-sync-alt"></i>
                            <div>
                                <strong>Valores Recíprocos</strong>
                                <p>Os valores simétricos na matriz são calculados automaticamente. Exemplo: se A comparado a B = 3, então B comparado a A = 1/3.</p>
                            </div>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-check-circle"></i>
                            <div>
                                <strong>Índice de Consistência</strong>
                                <p>Após preencher, o sistema calculará o índice de consistência (CR). Valores abaixo de 0,10 indicam comparações consistentes.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Main Content Section -->
            <section class="ahp-section">
                <h2 class="step-title">
                    <span class="step-number">4</span>
                    <span>Comparação Pareada</span>
                </h2>
                
                <!-- Card 4.1: Escala de Intensidade de Importância -->
                <div class="info-card info-card--spaced">
                    <div class="info-card-header">
                        <i class="fas fa-balance-scale"></i>
                        <h3>4.1 Escala de Intensidade de Importância</h3>
                    </div>
                    <div class="info-card-content">
                        <p class="saaty-description">
                            A <strong>Escala de Intensidade de Importância de Saaty</strong> é utilizada no método AHP para 
                            quantificar as preferências entre critérios durante a comparação pareada. Esta escala fundamental 
                            varia de 1 a 9, onde <strong>1 representa igual importância</strong> entre dois critérios e 
                            <strong>9 representa importância extrema</strong> de um critério sobre o outro. Os valores 
                            intermediários (3, 5, 7) representam níveis moderado, forte e muito forte de importância, 
                            respectivamente. Os valores recíprocos (1/3, 1/5, 1/7, 1/9) são utilizados quando o segundo 
                            critério é mais importante que o primeiro.
                        </p>
                        <div class="saaty-image-container">
                            <img src="img_folder/escala_intensidade_importancia_criterios_ahp.png" 
                                 alt="Escala de Intensidade de Importância - Método AHP" 
                                 class="saaty-image">
                        </div>
                    </div>
                </div>

                <!-- Card 4.2: Matriz/Formulário de Comparação Pareada -->
                <div class="info-card info-card--spaced">
                    <div class="info-card-header">
                        <i class="fas fa-table" id="methodIcon"></i>
                        <h3 id="methodCardTitle">4.2 Matriz de Comparação Pareada</h3>
                    </div>
                    <div class="info-card-content">
                        <!-- Instruções dinâmicas -->
                        <div id="instructions" class="instructions-container">
                            <p id="instructionsText" class="instructions-text">
                                <!-- Será preenchido dinamicamente -->
                            </p>
                        </div>
                        
                        <!-- Área de Comparação -->
                        <div id="comparisonContent" class="comparison-content">
                            <!-- Matriz ou Formulário será gerado dinamicamente -->
                        </div>
                    </div>
                </div>
                
                <div class="c-form-actions">
                    <a href="step3-metodo.html" class="c-btn c-btn--secondary">
                        <i class="fas fa-arrow-left c-btn__icon"></i>Voltar
                    </a>
                    <button onclick="calculateResults()" class="c-btn c-btn--primary">
                        Calcular Resultados<i class="fas fa-arrow-right c-btn__icon c-btn__icon--right"></i>
                    </button>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="l-footer">
        <div class="l-footer__content">
            <p>&copy; 2025 SIGMA - Sistema Integrado de Gestão, Monitoramento e Apoio técnico ao PLI/SP-2050. Todos os direitos reservados.</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="js/script.js"></script>
    <script>
        // Todas as variáveis já estão declaradas em script.js

        document.addEventListener('DOMContentLoaded', function() {
            const savedCriteria = localStorage.getItem('ahp_criteria');
            const savedMethod = localStorage.getItem('ahp_chosenMethod');
            
            if (!savedCriteria || !savedMethod) {
                alert('Dados incompletos. Redirecionando...');
                window.location.href = 'step1-criterios.html';
                return;
            }

            criteria = JSON.parse(savedCriteria);
            const method = savedMethod;
            
            const methodCardTitle = document.getElementById('methodCardTitle');
            const methodIcon = document.getElementById('methodIcon');
            const instructionsText = document.getElementById('instructionsText');
            
            if (method === 'matrix') {
                methodIcon.className = 'fas fa-table';
                methodCardTitle.textContent = '4.2 Matriz de Comparação Pareada';
                instructionsText.innerHTML = '<strong>Como preencher a Matriz:</strong> Você pode preencher <strong>qualquer célula da matriz</strong> (exceto a diagonal principal). Ao selecionar um valor em uma célula, o sistema automaticamente ajustará a célula simétrica oposta com o valor recíproco. Use a Escala de Saaty apresentada acima para suas comparações.';
                generateDirectMatrix();
            } else {
                methodIcon.className = 'fas fa-clipboard-list';
                methodCardTitle.textContent = '4.2 Formulário de Comparação Pareada';
                instructionsText.innerHTML = '<strong>Como preencher o Formulário:</strong> Para cada par de critérios apresentado, selecione a intensidade de importância usando a Escala de Saaty. Compare o <strong>Critério 1 com o Critério 2</strong>, indicando qual é mais importante e em que grau. O sistema irá processar automaticamente as comparações recíprocas.';
                generatePairwiseForm();
            }
        });

        // Gerar Matriz Direta
        function generateDirectMatrix() {
            const n = criteria.length;
            const container = document.getElementById('comparisonContent');
            
            let html = '<div style="overflow-x: auto;"><table class="matrix-table">';
            html += '<thead><tr><th style="background: var(--pli-azul-escuro); color: white;">Critérios</th>';
            
            for (let j = 0; j < n; j++) {
                html += '<th style="background: var(--pli-azul-escuro); color: white;">' + criteria[j] + '</th>';
            }
            html += '</tr></thead><tbody>';
            
            for (let i = 0; i < n; i++) {
                html += '<tr>';
                html += '<th style="background: var(--pli-azul-escuro); color: white;">' + criteria[i] + '</th>';
                
                for (let j = 0; j < n; j++) {
                    if (i === j) {
                        html += '<td style="background: #e8f4f8; font-weight: bold; text-align: center;">1</td>';
                    } else {
                        html += '<td>' + createSelectInput(i, j) + '</td>';
                    }
                }
                html += '</tr>';
            }
            
            html += '</tbody></table></div>';
            html += '<div style="margin-top: 1rem; padding: 0.75rem; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 4px;">';
            html += '<p style="margin: 0; color: #856404; font-size: 0.9rem; text-align: justify;"><i class="fas fa-info-circle"></i> <strong>Nota:</strong> Todas as células podem ser preenchidas. Ao selecionar um valor em qualquer célula, a célula oposta (simétrica) será automaticamente preenchida com o valor recíproco. Exemplo: se você selecionar "3" na célula [A,B], a célula [B,A] será automaticamente ajustada para "1/3".</p>';
            html += '</div>';
            container.innerHTML = html;
        }

        // Gerar Formulário de Comparação
        function generatePairwiseForm() {
            const n = criteria.length;
            const container = document.getElementById('comparisonContent');
            
            let html = '<table class="matrix-table">';
            html += '<thead><tr>';
            html += '<th style="background: var(--pli-azul-escuro); color: white;">Critério 1</th>';
            html += '<th style="background: var(--pli-azul-escuro); color: white;">Critério 2</th>';
            html += '<th style="background: var(--pli-azul-escuro); color: white;">Importância (Escala AHP)</th>';
            html += '</tr></thead><tbody>';
            
            for (let i = 0; i < n - 1; i++) {
                for (let j = i + 1; j < n; j++) {
                    html += '<tr>';
                    html += '<td><strong>' + criteria[i] + '</strong></td>';
                    html += '<td><strong>' + criteria[j] + '</strong></td>';
                    html += '<td>' + createSelectInput(i, j) + '</td>';
                    html += '</tr>';
                }
            }
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // Criar select com escala de Saaty - apenas valores numéricos
        function createSelectInput(i, j) {
            const options = [
                {value: 1/9, label: '1/9'},
                {value: 1/8, label: '1/8'},
                {value: 1/7, label: '1/7'},
                {value: 1/6, label: '1/6'},
                {value: 1/5, label: '1/5'},
                {value: 1/4, label: '1/4'},
                {value: 1/3, label: '1/3'},
                {value: 1/2, label: '1/2'},
                {value: 1,   label: '1'},
                {value: 2,   label: '2'},
                {value: 3,   label: '3'},
                {value: 4,   label: '4'},
                {value: 5,   label: '5'},
                {value: 6,   label: '6'},
                {value: 7,   label: '7'},
                {value: 8,   label: '8'},
                {value: 9,   label: '9'}
            ];
            
            const selectId = 'pair_' + i + '_' + j;
            const ariaLabel = 'Comparação entre ' + criteria[i] + ' e ' + criteria[j];
            let selectHtml = '<select id="' + selectId + '" onchange="storePairwiseValue(' + i + ', ' + j + ')" class="c-form-control" aria-label="' + ariaLabel + '">';
            
            for (let opt of options) {
                let selected = (Number(opt.value) === 1) ? 'selected' : '';
                selectHtml += '<option value="' + opt.value + '" ' + selected + '>' + opt.label + '</option>';
            }
            
            selectHtml += '</select>';
            pairwiseValues[selectId] = 1;
            return selectHtml;
        }

        // Armazenar valor selecionado e atualizar recíproco
        function storePairwiseValue(i, j) {
            const selectId = 'pair_' + i + '_' + j;
            const reciprocalSelectId = 'pair_' + j + '_' + i;
            const val = parseFloat(document.getElementById(selectId).value);
            
            // Armazenar valor atual
            pairwiseValues[selectId] = val;
            
            // Calcular e definir o valor recíproco no select oposto
            const reciprocal = 1 / val;
            const reciprocalSelect = document.getElementById(reciprocalSelectId);
            
            if (reciprocalSelect) {
                // Encontrar o valor mais próximo disponível no select
                reciprocalSelect.value = reciprocal;
                pairwiseValues[reciprocalSelectId] = reciprocal;
            }
        }

        // Calcular e ir para resultados
        function calculateResults() {
            const n = criteria.length;
            pairwiseMatrix = [];
            
            // Construir matriz completa
            for (let i = 0; i < n; i++) {
                pairwiseMatrix[i] = [];
                for (let j = 0; j < n; j++) {
                    if (i === j) {
                        pairwiseMatrix[i][j] = 1;
                    } else if (i < j) {
                        const selectId = 'pair_' + i + '_' + j;
                        const val = parseFloat(document.getElementById(selectId).value);
                        pairwiseMatrix[i][j] = val;
                    } else {
                        const selectId = 'pair_' + j + '_' + i;
                        const val = parseFloat(document.getElementById(selectId).value);
                        pairwiseMatrix[i][j] = 1 / val;
                    }
                }
            }
            
            localStorage.setItem('ahp_pairwiseMatrix', JSON.stringify(pairwiseMatrix));
            window.location.href = 'step5-resultados.html';
        }
    </script>
</body>
</html>
