<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Etapa 5: Resultados - SIGMA AHP</title>

    <!-- SIGMA AHP specific styles -->
    <link rel="stylesheet" href="sigma-ahp.css">

    <!-- Font Awesome para ícones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <!-- Montserrat Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- jsPDF para exportação PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- SheetJS para exportação Excel -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
</head>
<body>
    <!-- PLI Navbar Header -->
    <header class="l-header">
        <nav class="pli-navbar">
            <div class="pli-navbar__container">
                <a href="sigma-ahp.html" class="pli-navbar__brand">
                    <i class="fas fa-calculator"></i> SIGMA - AHP Calculator
                </a>

                <ul class="pli-navbar__nav">
                    <li><a href="sigma-ahp.html" class="pli-navbar__link">Início</a></li>
                    <li><a href="#" class="pli-navbar__link pli-navbar__link--active">Calculadora</a></li>
                    <li><a href="#" class="pli-navbar__link">Ajuda</a></li>
                </ul>

                <div class="pli-navbar__utilities">
                    <button class="pli-navbar__notification">
                        <i class="fas fa-bell"></i>
                        <span class="pli-navbar__notification-badge">3</span>
                    </button>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="l-main">
        <div class="l-container">
            <!-- Breadcrumb Navigation -->
            <nav class="breadcrumb">
                <a href="sigma-ahp.html"><i class="fas fa-home"></i> Início</a>
                <span class="breadcrumb-separator">/</span>
                <a href="step1-criterios.html">Etapa 1</a>
                <span class="breadcrumb-separator">/</span>
                <a href="step2-nomes.html">Etapa 2</a>
                <span class="breadcrumb-separator">/</span>
                <a href="step3-metodo.html">Etapa 3</a>
                <span class="breadcrumb-separator">/</span>
                <a href="step4-comparacao.html">Etapa 4</a>
                <span class="breadcrumb-separator">/</span>
                <span class="breadcrumb-current">Etapa 5: Resultados</span>
            </nav>

            <!-- Progress Bar -->
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-step completed">
                        <div class="progress-circle">1</div>
                        <span>Critérios</span>
                    </div>
                    <div class="progress-step completed">
                        <div class="progress-circle">2</div>
                        <span>Nomes</span>
                    </div>
                    <div class="progress-step completed">
                        <div class="progress-circle">3</div>
                        <span>Método</span>
                    </div>
                    <div class="progress-step completed">
                        <div class="progress-circle">4</div>
                        <span>Comparação</span>
                    </div>
                    <div class="progress-step active">
                        <div class="progress-circle">5</div>
                        <span>Resultados</span>
                    </div>
                </div>
            </div>

            <!-- Info Card -->
            <section class="ahp-section info-card">
                <div class="info-card-header">
                    <i class="fas fa-check-circle"></i>
                    <h2>Resultados da Análise AHP</h2>
                </div>
                <div class="info-card-content">
                    <p>Confira abaixo os <strong>pesos calculados</strong> para cada critério e o <strong>índice de consistência</strong> das comparações realizadas.</p>
                    
                    <div class="info-highlights">
                        <div class="info-item">
                            <i class="fas fa-percent"></i>
                            <div>
                                <strong>Pesos dos Critérios</strong>
                                <p>Indicam a importância relativa de cada critério no processo decisório.</p>
                            </div>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-check-double"></i>
                            <div>
                                <strong>Razão de Consistência (CR)</strong>
                                <p>Valores abaixo de 0,10 indicam que as comparações são consistentes e confiáveis.</p>
                            </div>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-file-download"></i>
                            <div>
                                <strong>Exportar Resultados</strong>
                                <p>Salve os resultados em PDF, Excel ou CSV para documentação e compartilhamento.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Main Content Section -->
            <section class="ahp-section">
                <h2 class="step-title">
                    <span class="step-number">5</span>
                    Resultados e Exportação
                </h2>
                
                <div id="resultsContent">
                    <!-- Resultados serão gerados dinamicamente -->
                </div>
                
                <div class="c-form-actions">
                    <a href="step4-comparacao.html" class="c-btn c-btn--secondary">
                        <i class="fas fa-arrow-left c-btn__icon"></i>Voltar
                    </a>
                    <a href="sigma-ahp.html" class="c-btn c-btn--primary">
                        <i class="fas fa-home c-btn__icon"></i>Nova Análise
                    </a>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="l-footer">
        <div class="l-footer__content">
            <p>&copy; 2025 SIGMA - Sistema Integrado de Gestão, Monitoramento e Apoio técnico ao PLI/SP-2050. Todos os direitos reservados.</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="js/script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar se foi usado método de upload
            const inputMethod = localStorage.getItem('ahp_inputMethod');
            let criteria, matrix;

            if (inputMethod === 'upload') {
                // Carregar dados do upload
                criteria = JSON.parse(localStorage.getItem('ahp_criteria') || '[]');
                const uploadedMatrix = JSON.parse(localStorage.getItem('ahp_uploadedMatrix') || '[]');
                
                if (criteria.length === 0 || uploadedMatrix.length === 0) {
                    alert('Dados de upload incompletos. Redirecionando...');
                    window.location.href = 'step1-criterios.html';
                    return;
                }

                matrix = uploadedMatrix;
                
                // Salvar matriz no formato esperado para compatibilidade
                localStorage.setItem('ahp_pairwiseMatrix', JSON.stringify(matrix));
            } else {
                // Carregar dados do método manual
                criteria = JSON.parse(localStorage.getItem('ahp_criteria') || '[]');
                matrix = JSON.parse(localStorage.getItem('ahp_pairwiseMatrix') || '[]');
                
                if (criteria.length === 0 || matrix.length === 0) {
                    alert('Dados incompletos. Redirecionando...');
                    window.location.href = 'step1-criterios.html';
                    return;
                }
            }

            const results = calculateAHP(matrix);
            displayResults(criteria, results);
        });

        function calculateAHP(matrix) {
            const n = matrix.length;
            const weights = [];
            
            // Calcular médias geométricas
            for (let i = 0; i < n; i++) {
                let product = 1;
                for (let j = 0; j < n; j++) {
                    product *= matrix[i][j];
                }
                weights[i] = Math.pow(product, 1/n);
            }
            
            // Normalizar
            const sum = weights.reduce((a, b) => a + b, 0);
            const normalized = weights.map(w => w / sum);
            
            // Calcular λ_max (Lambda Máximo)
            let lambdaMax = 0;
            for (let i = 0; i < n; i++) {
                let sum = 0;
                for (let j = 0; j < n; j++) {
                    sum += matrix[j][i] * normalized[j];
                }
                lambdaMax += sum / normalized[i];
            }
            lambdaMax /= n;
            
            // Calcular CI (Índice de Consistência)
            const CI = (lambdaMax - n) / (n - 1);
            
            // Calcular CR (Razão de Consistência)
            const RI = [0, 0, 0.58, 0.90, 1.12, 1.24, 1.32, 1.41, 1.45, 1.49];
            const CR = n > 2 ? CI / RI[n] : 0;
            
            return { 
                weights: normalized, 
                lambdaMax: lambdaMax,
                CI: CI,
                CR: CR 
            };
        }

        function displayResults(criteria, results) {
            let html = '';
            
            // Card 5.1: Pesos dos Critérios
            html += '<div class="info-card info-card--spaced">';
            html += '<div class="info-card-header"><i class="fas fa-chart-bar"></i><h3>5.1 Pesos dos Critérios</h3></div>';
            html += '<div class="info-card-content">';
            html += '<p style="margin-bottom: 1.5rem;">Os pesos representam a importância relativa de cada critério na decisão. Foram calculados utilizando o método da média geométrica.</p>';
            html += '<table class="matrix-table"><thead><tr>';
            html += '<th style="background: var(--pli-azul-escuro); color: white;">Critério</th>';
            html += '<th style="background: var(--pli-azul-escuro); color: white;">Peso</th>';
            html += '<th style="background: var(--pli-azul-escuro); color: white;">Percentual</th>';
            html += '<th style="background: var(--pli-azul-escuro); color: white;">Gráfico</th>';
            html += '</tr></thead><tbody>';
            
            criteria.forEach((c, i) => {
                const weight = results.weights[i];
                const percent = (weight * 100).toFixed(2);
                const barWidth = percent;
                html += '<tr>';
                html += '<td><strong>' + c + '</strong></td>';
                html += '<td>' + weight.toFixed(4) + '</td>';
                html += '<td>' + percent + '%</td>';
                html += '<td><div style="background: var(--pli-verde-principal); height: 20px; width: ' + barWidth + '%; border-radius: 4px;"></div></td>';
                html += '</tr>';
            });
            
            html += '</tbody></table></div></div>';
            
            // Card 5.2: Métricas de Consistência
            html += '<div class="info-card info-card--spaced">';
            html += '<div class="info-card-header"><i class="fas fa-check-circle"></i><h3>5.2 Métricas de Consistência</h3></div>';
            html += '<div class="info-card-content">';
            
            html += '<p style="margin-bottom: 1.5rem;">O conjunto de métricas de consistência no método AHP serve para verificar se os julgamentos feitos entre critérios são logicamente coerentes. O valor próprio máximo (λ_max) indica o grau de consistência da matriz de comparação; o índice de consistência (CI) mede o desvio em relação à consistência ideal; e o índice aleatório (RI) representa o CI médio esperado em uma matriz aleatória. A razão de consistência (CR) é calculada como CR = CI / RI e, se for menor que 0,10, os julgamentos são considerados confiáveis. Essa verificação é essencial para validar a qualidade dos resultados obtidos.</p>';
            
            html += '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">';
            
            // λ_max (Lambda Máximo)
            html += '<div style="padding: 1.5rem; background: #f8f9fa; border-radius: 8px; border: 2px solid #dee2e6;">';
            html += '<div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;">';
            html += '<i class="fas fa-lambda" style="font-size: 1.5rem; color: var(--pli-azul-principal);"></i>';
            html += '<h4 style="margin: 0; color: var(--pli-azul-escuro);">λ<sub>max</sub> (Lambda Máximo)</h4>';
            html += '</div>';
            html += '<p style="font-size: 2rem; font-weight: bold; color: var(--pli-azul-principal); margin: 0.5rem 0;">' + results.lambdaMax.toFixed(4) + '</p>';
            html += '<p style="margin: 0; color: #666; font-size: 0.9rem;">Maior autovalor da matriz de comparação</p>';
            html += '</div>';
            
            // CI (Índice de Consistência)
            html += '<div style="padding: 1.5rem; background: #f8f9fa; border-radius: 8px; border: 2px solid #dee2e6;">';
            html += '<div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;">';
            html += '<i class="fas fa-calculator" style="font-size: 1.5rem; color: var(--pli-azul-principal);"></i>';
            html += '<h4 style="margin: 0; color: var(--pli-azul-escuro);">CI (Índice de Consistência)</h4>';
            html += '</div>';
            html += '<p style="font-size: 2rem; font-weight: bold; color: var(--pli-azul-principal); margin: 0.5rem 0;">' + results.CI.toFixed(4) + '</p>';
            html += '<p style="margin: 0; color: #666; font-size: 0.9rem;">CI = (λ<sub>max</sub> - n) / (n - 1)</p>';
            html += '</div>';
            
            // CR (Razão de Consistência)
            const crColor = results.CR < 0.10 ? 'var(--pli-verde-principal)' : '#dc3545';
            const crStatus = results.CR < 0.10 ? '✓ Consistente' : '✗ Inconsistente';
            html += '<div style="padding: 1.5rem; background: #f8f9fa; border-radius: 8px; border: 2px solid ' + crColor + ';">';
            html += '<div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;">';
            html += '<i class="fas fa-check-double" style="font-size: 1.5rem; color: ' + crColor + ';"></i>';
            html += '<h4 style="margin: 0; color: var(--pli-azul-escuro);">CR (Razão de Consistência)</h4>';
            html += '</div>';
            html += '<p style="font-size: 2rem; font-weight: bold; color: ' + crColor + '; margin: 0.5rem 0;">' + results.CR.toFixed(4) + '</p>';
            html += '<p style="margin: 0; color: ' + crColor + '; font-weight: bold; font-size: 0.9rem;">' + crStatus + '</p>';
            html += '</div>';
            
            html += '</div>';
            
            // Explicação das métricas
            html += '<div style="background: #e3f2fd; padding: 1.25rem; border-radius: 8px; margin-top: 1rem;">';
            html += '<h4 style="margin-top: 0; color: var(--pli-azul-escuro);"><i class="fas fa-info-circle"></i> Como Interpretar:</h4>';
            html += '<ul style="margin: 0; padding-left: 1.5rem; line-height: 1.8; text-align: justify;">';
            html += '<li><strong>λ<sub>max</sub> (Lambda Máximo):</strong> Quanto mais próximo de n (número de critérios), mais consistente é a matriz. Valor ideal: igual a n.</li>';
            html += '<li><strong>CI (Índice de Consistência):</strong> Mede o desvio da consistência. Valor ideal: 0 (perfeitamente consistente).</li>';
            html += '<li><strong>CR (Razão de Consistência):</strong> Métrica final de consistência. <strong>CR < 0,10 (10%)</strong> indica comparações aceitáveis. <strong>CR ≥ 0,10</strong> sugere revisar as comparações.</li>';
            html += '</ul>';
            html += '</div>';
            
            html += '</div></div>';
            
            // Card 5.3: Exportar Resultados
            html += '<div class="info-card info-card--spaced">';
            html += '<div class="info-card-header"><i class="fas fa-download"></i><h3>5.3 Exportar Resultados</h3></div>';
            html += '<div class="info-card-content">';
            html += '<p style="margin-bottom: 1.5rem;">Exporte os resultados da análise AHP em diferentes formatos para uso em relatórios, apresentações ou outras ferramentas.</p>';
            html += '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">';
            html += '<button onclick="exportToCSV()" class="c-btn c-btn--primary" style="width: 100%;"><i class="fas fa-file-csv"></i> Exportar CSV</button>';
            html += '<button onclick="exportToJSON()" class="c-btn c-btn--primary" style="width: 100%;"><i class="fas fa-file-code"></i> Exportar JSON</button>';
            html += '<button onclick="exportToPDF()" class="c-btn c-btn--primary" style="width: 100%;"><i class="fas fa-file-pdf"></i> Exportar PDF</button>';
            html += '<button onclick="exportToExcel()" class="c-btn c-btn--primary" style="width: 100%;"><i class="fas fa-file-excel"></i> Exportar Excel</button>';
            html += '</div>';
            html += '</div></div>';
            
            document.getElementById('resultsContent').innerHTML = html;
        }

        // Funções de exportação
        function exportToCSV() {
            const criteria = JSON.parse(localStorage.getItem('ahp_criteria'));
            const matrix = JSON.parse(localStorage.getItem('ahp_pairwiseMatrix'));
            const results = calculateAHP(matrix);
            
            let csv = 'Critério,Peso,Percentual\n';
            criteria.forEach((c, i) => {
                csv += c + ',' + results.weights[i].toFixed(4) + ',' + (results.weights[i] * 100).toFixed(2) + '%\n';
            });
            csv += '\nMétricas de Consistência\n';
            csv += 'Lambda Máximo,' + results.lambdaMax.toFixed(4) + '\n';
            csv += 'Índice de Consistência (CI),' + results.CI.toFixed(4) + '\n';
            csv += 'Razão de Consistência (CR),' + results.CR.toFixed(4) + '\n';
            
            downloadFile(csv, 'resultados_ahp.csv', 'text/csv');
        }

        function exportToJSON() {
            const criteria = JSON.parse(localStorage.getItem('ahp_criteria'));
            const matrix = JSON.parse(localStorage.getItem('ahp_pairwiseMatrix'));
            const results = calculateAHP(matrix);
            
            const data = {
                criteria: criteria,
                weights: results.weights,
                metrics: {
                    lambdaMax: results.lambdaMax,
                    CI: results.CI,
                    CR: results.CR
                },
                matrix: matrix,
                timestamp: new Date().toISOString()
            };
            
            downloadFile(JSON.stringify(data, null, 2), 'resultados_ahp.json', 'application/json');
        }

        function exportToPDF() {
            const criteria = JSON.parse(localStorage.getItem('ahp_criteria'));
            const matrix = JSON.parse(localStorage.getItem('ahp_pairwiseMatrix'));
            const results = calculateAHP(matrix);
            
            // Verificar se jsPDF está disponível
            if (typeof window.jspdf === 'undefined') {
                alert('Erro: Biblioteca jsPDF não carregada. Verifique sua conexão com a internet.');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Configurações
            const pageWidth = doc.internal.pageSize.getWidth();
            const margin = 20;
            let yPos = 20;
            
            // Título
            doc.setFontSize(18);
            doc.setFont(undefined, 'bold');
            doc.text('Resultados da Análise AHP', margin, yPos);
            yPos += 10;
            
            // Linha separadora
            doc.setLineWidth(0.5);
            doc.line(margin, yPos, pageWidth - margin, yPos);
            yPos += 10;
            
            // Data
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.text('Data: ' + new Date().toLocaleDateString('pt-BR'), margin, yPos);
            yPos += 15;
            
            // Seção: Pesos dos Critérios
            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            doc.text('Pesos dos Critérios', margin, yPos);
            yPos += 8;
            
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            criteria.forEach((criterion, i) => {
                const weight = (results.weights[i] * 100).toFixed(2);
                doc.text(`${i + 1}. ${criterion}: ${weight}%`, margin + 5, yPos);
                yPos += 6;
            });
            
            yPos += 5;
            
            // Seção: Métricas de Consistência
            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            doc.text('Métricas de Consistência', margin, yPos);
            yPos += 8;
            
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.text(`Lambda Máximo (λmax): ${results.lambdaMax.toFixed(4)}`, margin + 5, yPos);
            yPos += 6;
            doc.text(`Índice de Consistência (CI): ${results.CI.toFixed(4)}`, margin + 5, yPos);
            yPos += 6;
            doc.text(`Razão de Consistência (CR): ${results.CR.toFixed(4)}`, margin + 5, yPos);
            yPos += 6;
            
            // Status de consistência
            const status = results.CR < 0.10 ? '✓ Consistente (CR < 0.10)' : '✗ Inconsistente (CR ≥ 0.10)';
            doc.setFont(undefined, 'bold');
            doc.text(`Status: ${status}`, margin + 5, yPos);
            yPos += 10;
            
            // Seção: Matriz de Comparação (nova página se necessário)
            if (yPos > 250) {
                doc.addPage();
                yPos = 20;
            }
            
            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            doc.text('Matriz de Comparação Pareada', margin, yPos);
            yPos += 8;
            
            // Criar tabela da matriz
            doc.setFontSize(8);
            doc.setFont(undefined, 'normal');
            
            const cellWidth = 25;
            const cellHeight = 6;
            
            // Cabeçalho
            doc.setFont(undefined, 'bold');
            criteria.forEach((criterion, i) => {
                const shortName = criterion.length > 10 ? criterion.substring(0, 8) + '..' : criterion;
                doc.text(shortName, margin + (i + 1) * cellWidth, yPos);
            });
            yPos += cellHeight;
            
            // Linhas da matriz
            doc.setFont(undefined, 'normal');
            criteria.forEach((criterion, i) => {
                const shortName = criterion.length > 10 ? criterion.substring(0, 8) + '..' : criterion;
                doc.text(shortName, margin, yPos);
                
                matrix[i].forEach((value, j) => {
                    doc.text(value.toFixed(2), margin + (j + 1) * cellWidth, yPos);
                });
                yPos += cellHeight;
            });
            
            // Rodapé
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(8);
                doc.setFont(undefined, 'normal');
                doc.text(
                    `SIGMA AHP - Página ${i} de ${pageCount}`,
                    pageWidth / 2,
                    doc.internal.pageSize.getHeight() - 10,
                    { align: 'center' }
                );
            }
            
            // Salvar
            doc.save('resultados_ahp.pdf');
        }

        function exportToExcel() {
            const criteria = JSON.parse(localStorage.getItem('ahp_criteria'));
            const matrix = JSON.parse(localStorage.getItem('ahp_pairwiseMatrix'));
            const results = calculateAHP(matrix);
            
            // Verificar se XLSX está disponível
            if (typeof XLSX === 'undefined') {
                alert('Erro: Biblioteca SheetJS não carregada. Verifique sua conexão com a internet.');
                return;
            }
            
            // Criar workbook
            const wb = XLSX.utils.book_new();
            
            // Planilha 1: Pesos dos Critérios
            const wsData1 = [
                ['RESULTADOS DA ANÁLISE AHP'],
                [],
                ['PESOS DOS CRITÉRIOS'],
                ['Critério', 'Peso', 'Percentual'],
            ];
            
            criteria.forEach((criterion, i) => {
                wsData1.push([
                    criterion,
                    results.weights[i].toFixed(4),
                    (results.weights[i] * 100).toFixed(2) + '%'
                ]);
            });
            
            const ws1 = XLSX.utils.aoa_to_sheet(wsData1);
            
            // Estilizar cabeçalhos
            ws1['!cols'] = [
                { wch: 30 },  // Critério
                { wch: 15 },  // Peso
                { wch: 15 }   // Percentual
            ];
            
            XLSX.utils.book_append_sheet(wb, ws1, 'Pesos');
            
            // Planilha 2: Métricas de Consistência
            const wsData2 = [
                ['MÉTRICAS DE CONSISTÊNCIA'],
                [],
                ['Métrica', 'Valor', 'Descrição'],
                ['Lambda Máximo (λmax)', results.lambdaMax.toFixed(4), 'Maior autovalor da matriz'],
                ['Índice de Consistência (CI)', results.CI.toFixed(4), 'CI = (λmax - n) / (n - 1)'],
                ['Razão de Consistência (CR)', results.CR.toFixed(4), 'CR = CI / RI'],
                [],
                ['Status', results.CR < 0.10 ? 'Consistente' : 'Inconsistente', results.CR < 0.10 ? 'CR < 0.10 (Aceitável)' : 'CR ≥ 0.10 (Revisar)']
            ];
            
            const ws2 = XLSX.utils.aoa_to_sheet(wsData2);
            ws2['!cols'] = [
                { wch: 30 },
                { wch: 15 },
                { wch: 40 }
            ];
            
            XLSX.utils.book_append_sheet(wb, ws2, 'Métricas');
            
            // Planilha 3: Matriz de Comparação
            const wsData3 = [
                ['MATRIZ DE COMPARAÇÃO PAREADA'],
                []
            ];
            
            // Cabeçalho da matriz
            const header = [''];
            criteria.forEach(c => header.push(c));
            wsData3.push(header);
            
            // Dados da matriz
            criteria.forEach((criterion, i) => {
                const row = [criterion];
                matrix[i].forEach(value => {
                    row.push(parseFloat(value.toFixed(4)));
                });
                wsData3.push(row);
            });
            
            const ws3 = XLSX.utils.aoa_to_sheet(wsData3);
            
            // Largura das colunas
            const colWidths = [{ wch: 20 }];
            criteria.forEach(() => colWidths.push({ wch: 12 }));
            ws3['!cols'] = colWidths;
            
            XLSX.utils.book_append_sheet(wb, ws3, 'Matriz');
            
            // Salvar arquivo
            XLSX.writeFile(wb, 'resultados_ahp.xlsx');
        }

        function downloadFile(content, filename, contentType) {
            const blob = new Blob([content], { type: contentType });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
